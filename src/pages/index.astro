---
import { type CollectionEntry, getCollection } from "astro:content";
import SocialList from "@/components/SocialList.astro";
import PostPreview from "@/components/blog/PostPreview.astro";
import Bookmark from "@/components/bookmark/Bookmark.astro";
import Note from "@/components/note/Note.astro";
import { getAllPostsByDate } from "@/data/post";
import PageLayout from "@/layouts/Base.astro";
import { collectionDateSort } from "@/utils/date";

// Posts
const MAX_POSTS = 10;
const allPosts = await getAllPostsByDate();
const latestPosts = allPosts.slice(0, MAX_POSTS) as CollectionEntry<"post">[];

// Notes
const MAX_NOTES = 2;
const allNotes = await getCollection("note");
const latestNotes = allNotes.sort(collectionDateSort).slice(0, MAX_NOTES);

// Bookmarks
const MAX_BOOKMARKS = 3;
const allBookmarks = await getCollection("bookmark");
const latestBookmarks = allBookmarks
	.sort((a, b) => b.data.readDate.getTime() - a.data.readDate.getTime())
	.slice(0, MAX_BOOKMARKS);
---

<PageLayout meta={{ title: "Home" }}>
	<section>
		<h1 class="title mb-6">Howdy ğŸ‘‹</h1>
		<div>
			<img
				class="rounded-md outline -outline-offset-1 outline-black/10 md:float-right md:mb-2 md:ml-3 md:w-2/5"
				src="/anurag-smirk.jpg"
				alt="Anurag sitting in front of his computer monitor with a big smile on his face."
			/>
			<div class="mt-4 text-base">
				<p class="mb-4">
					Welcome to the garden of <a class="cactus-link" href="https://anuragbhandari.com"
						>Anurag Bhandari</a
					> the developer, a <strong><a class="cactus-link" href="/about/">generalist</a></strong> software
					engg.
				</p>
				<p class="mb-4">
					This little space on the web is where I write about my coding (mis)adventures, share
					bookmarks, and scribble short notes to help my future self (and you?) learn something
					useful.
				</p>
				<p class="mb-4">
					ğŸ© Hats I have worn over the years:
					<br />
					Full-Stack Engineer, Engineering Manager, Frontend Architect, Applied R&D Technologist, Linux
					Developer, OSS Founder, and "<span class="decoration-accent underline decoration-wavy"
						>the guy who'll fix my computer</span
					>".
				</p>
				<p class="mb-4">
					I love experimenting with shiny new things âœ¨, learning through knowledge sharing ğŸ“£, and
					spraying emojis ğŸ™‚.
				</p>
			</div>
		</div>
	</section>
	<SocialList />
	<section class="mt-16">
		<h2 class="title text-accent mb-6 text-xl">
			<a href="/posts/">ğŸ“ Posts ({allPosts.length})</a>
		</h2>
		<ul class="space-y-6" role="list">
			{
				latestPosts.map((p) => (
					<li class="grid gap-2 sm:grid-cols-[auto_1fr]">
						<PostPreview post={p} />
					</li>
				))
			}
		</ul>
	</section>
	{
		latestNotes.length > 0 && (
			<section class="mt-16">
				<h2 class="title text-accent mb-6 text-xl">
					<a href="/notes/">ğŸ¤” Notes ({allNotes.length})</a>
				</h2>
				<ul class="space-y-6" role="list">
					{latestNotes.map((note) => (
						<li>
							<Note note={note} as="h3" isPreview />
						</li>
					))}
				</ul>
			</section>
		)
	}
	{
		latestBookmarks.length > 0 && (
			<section class="mt-16">
				<h2 class="title text-accent mb-6 text-xl">
					<a href="/bookmarks/">ğŸ”– Bookmarks ({allBookmarks.length})</a>
				</h2>
				<ul class="space-y-6" role="list">
					{latestBookmarks.map((bookmark) => (
						<li>
							<Bookmark bookmark={bookmark} as="h3" isPreview />
						</li>
					))}
				</ul>
			</section>
		)
	}
</PageLayout>
